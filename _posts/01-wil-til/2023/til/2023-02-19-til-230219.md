---
title: âœ¨TIL - ë²„ì „ ë³€ê²½ìœ¼ë¡œì¸í•œ ë§ì€ ë³€í™”
author: ggggraceful
date: 2023-02-19
categories: [01.TIL/WIL, TIL]
tags: [TIL]
---

<br/>
<br/>

# QueryDsl ì„¤ì •

---

ì›ë˜ëŠ” ì§€ë‚œë²ˆê³¼ ë‹¤ë¥´ê²Œ  JPAë¥¼ ì‚¬ìš© ì •ë ¬ê³¼ í•„í„°ë¥¼ ì‹œë„í•´ ë³´ë ¤í–ˆë‹¤.
ë‹¤ìŒì€ ë‚´ê°€ ì°¾ì•„ë³¸ JPAë¥¼ ì‚¬ìš©í•´ì„œ ì •ë ¬í•˜ëŠ” ë°©ë²•ì´ë‹¤.  


```java
@Controller
public List<T> list(Pageable pageable)
{
  List<T> tList = jpaRepository.findAll(pageable);
  return tList;
}
```

```java
public Page<T> findAllByNameOrderByCreatedDateDesc();
```

- [ì°¸ê³ ë§í¬](https://jistol.github.io/spring/2017/02/11/jpa-sort/)

<br/>

ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œ JPQL ì¿¼ë¦¬ ìƒì„±ë¡œë„ ê²€ìƒ‰, ì •ë ¬ì´ ê°€ëŠ¥í•˜ê³ 
```java
public interface MemberRepsoitory extends JpaRepository<Member, Long> {
    List<Member> findByUsername(String username); // ê²€ìƒ‰

    List<member> findByUsername(String username, Sort sort); // ê²€ìƒ‰ + ì •ë ¬

    List<Member> findByUsername(String username, Pageable Pagealbe); // ê²€ìƒ‰ + ì •ë ¬ + í˜ì´ì§•
}
```

<br/>

@Queryë¥¼ ì‚¬ìš©í•´ì„œ ì§ì ‘ JPQL ì§€ì •í•˜ëŠ” ë°©ë²•ìœ¼ë¡œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

```java
public interface MemberRepsoitory extends JpaRepository<Member, Long> {
    @Query("SELECT m FROM Member m WHERE m.username = ?1")
    List<Member> findByUsername(String username);
}
```

ì´ë ‡ê²Œ ì¿¼ë¦¬ë¬¸ì„ ì§ì ‘ ì“°ê²Œ ë˜ë©´ ê²°êµ­ Querydslì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ê³¼ ë³„ ë‹¤ë¥´ì§€ ì•Šë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. 

- [8. Spring Data JPAì™€ QueryDSL ì´í•´](https://rutgo-letsgo.tistory.com/207)

Querydslì€ SQL, JPQLì„ ì½”ë“œë¡œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤ëŠ” ì˜ë¯¸ê°€ ë¬´ì—‡ì¸ì§€ ì˜ˆì‹œ ì½”ë“œë“¤ë¡œ ì´í•´í•  ìˆ˜ ìˆì—ˆë‹¤. 
ê²°êµ­ ì¿¼ë¦¬ë¬¸ìœ¼ë¡œ ì¢€ë” í¸ì•ˆí•˜ê²Œ ì‘ì„±í•˜ê¸° ìœ„í•´ Querydslë¡œ êµ¬í˜„í•˜ê¸°ë¡œ í•˜ì˜€ë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” Querydsl ì„¤ì •ì´ í•„ìš”í•˜ë‹¤!

<br/>
<br/>
<br/>

# ë²„ì „ ë³€ê²½ìœ¼ë¡œ ì¼ì–´ë‚œ ë³€í™”

---

 ì§€ë‚œë²ˆì—ëŠ” Java(11) / Spring Boot(2.7.6) ë²„ì „ì„ ì‚¬ìš©í–ˆì—ˆëŠ”ë°,  
ì´ë²ˆì—ëŠ” Java(17) / Spring Boot(3.0.2) ë²„ì „ì„ ì‚¬ìš©í•´ì„œ ì„¤ì •ë¶€ë¶„ì´ ì¢€ ë‹¬ë¼ì¡Œë‹¤.  
  
ì§€ë‚œë²ˆì—ë„ ì´ë²ˆì—ë„ Querydslì˜ ë²„ì „ì€ 5.0.0ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.  

ì´ë²ˆì— ë²„ì „ ë³€ê²½ìœ¼ë¡œ ìš°ë¦¬ í”„ë¡œì íŠ¸ì—ì„œ ì—…ë°ì´íŠ¸ í•œ ë¶€ë¶„ì´ë‹¤.

<br/>
- ì¼ë‹¨ Spring Boot(3.0)ì€ ìë°” 17ë²„ì „ë¶€í„° ì§€ì›í•œë‹¤ê³  í•œë‹¤. ìŠ¤í”„ë§ë¶€íŠ¸ 3.0ë²„ì „ì´ìƒì„ ì‚¬ìš©í•˜ë ¤ë©´ ìë°” 17ë²„ì „ì€ í•„ìˆ˜ì´ë‹¤. ì‚¬ì‹¤ ë§¨ì²˜ìŒ ìŠ¤í”„ë§ ì´ë‹ˆì…œë¼ì´ì €ì—ì„œ ìë°”11ë²„ì „ì— ìŠ¤í”„ë§ë¶€íŠ¸3.0ì„ ì„¤ì •í•˜ê³  í”„ë¡œì íŠ¸ë¥¼ ì—´ì—ˆëŠ”ë°, ë¹Œë“œ ê·¸ë˜ë“¤ë¶€ë¶„ì— ìë°” 17ë²„ì „ì´ ì í˜€ ìˆì–´ì„œ ë‹¹í™©í–ˆë‹¤ ã…‡ã……ã…‡ 

- ë˜ WebSecurityConfigíŒŒì¼ì—ì„œì˜ AntMatcherë¥¼ requestMatchersë¡œ ë³€ê²½í–ˆë‹¤. AntMatchersë¥¼ ë”ì´ìƒ ì§€ì›í•˜ì§€ ì•Šì•„ ë¹¨ê°„ì¤„ì´ ëœ¬ë‹¤. ê²€ìƒ‰í•´ë³´ë‹ˆ ì´ì œ ë”ì´ìƒ ì§€ì›í•˜ì§€ ì•Šì•„ì„œ requestMatchersë¡œ ë³€ê²½í•´ì£¼ì—ˆë‹¤.

- ìŠ¤í”„ë§ë¶€íŠ¸ 3.0ë²„ì „ë¶€í„°ëŠ” gradle - tasks- other - compileQuerydslì„ ëˆŒë¥´ì§€ ì•Šê³ ,  
  gradle - tasks - build - build ë§Œìœ¼ë¡œë„ QíŒŒì¼ì´ ìƒì„±ëœë‹¤ê³  í•œë‹¤.

- javaxê°€ ì§€ì›ì´ ì•ˆë˜ê³  jakartaë§Œ ê°€ëŠ¥í•´ ì „ì— ì‚¬ìš©í–ˆë˜ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¤ë©´ ì•ˆëœë‹¤. ì˜ë³´ê³  jakartaë¡œ importí•´ì•¼ ì‹¤í–‰ì´ ì˜ ë  ê²ƒì´ë‹¤. 
 
- ê·¸ë¦¬ê³  ë¹Œë“œ ê·¸ë˜ë“¤ì—ì„œì˜ Querydsl ì„¤ì •ë¶€ë¶„ì˜ ë§ì€ ë¶€ë¶„ì´ ë°”ë€Œì—ˆë‹¤. 

<br/>
<br/>

# Spirng Boot 3.0 + Querydsl 5.0.0 build.gradle ì„¤ì •

---

ì•„.. ë ë•Œê¹Œì§€ ì´ê²ƒì €ê²ƒ ë„£ì–´ë³´ëŠë¼ ê³ ìƒì¢€ í–ˆë‹¤..  
ê·¸ë¦¬ê³  ë§ˆì¹¨ë‚´ í•´ê²°í•˜ì˜€ë‹¤.  

ìŠ¤í”„ë§ë¶€íŠ¸ 3.0 + Querydsl 5.0.0 ì—ì„œ ë¹Œë“œí• ë•Œ ë˜ëŠ” ì‹¤í–‰í• ë•Œ ê³„ì†í•´ì„œ ì˜¤ë¥˜ê°€ ë‚¬ì—ˆë‹¤ ğŸ˜“

<br/>

ì´ì „ í”„ë¡œì íŠ¸ì—ì„œ  
Java(11) / Spring(2.7.6) + Querydsl ì‚¬ìš©ì‹œì˜ build.gradle  

```java
//queryDsl version ì •ë³´ ì¶”ê°€ 
// ğŸ‘‰ ì´ë²ˆì—ëŠ” ë²„ì „ê´€ë¦¬ë¥¼ ë”°ë¡œ í•˜ì§€ ì•Šì•„ í•„ìš”ì—†ëŠ” ë¶€ë¶„ìœ¼ë¡œ ì‚­ì œ
buildscript {
    ext {
        queryDslVersion = "5.0.0"
    }
}

plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.5' // ğŸ‘‰ ìŠ¤í”„ë§ë¶€íŠ¸ 3.0.2ë²„ì „ ì‚¬ìš©
    id 'io.spring.dependency-management' version '1.0.15.RELEASE'
//querydsl plugins ì¶”ê°€ ğŸ‘‰ ì´ë²ˆ ë²„ì „ì—ì„œëŠ” ì‚­ì œ
    id "com.ewerk.gradle.plugins.querydsl" version "1.0.10"
}

group = 'com.sparta'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11' // ğŸ‘‰ ìë°” 17ë²„ì „ ì‚¬ìš© 

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    compileOnly 'org.projectlombok:lombok'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    runtimeOnly 'com.h2database:h2'

    // querydsl ğŸ‘‰ ìƒˆë¡œìš´ ë‚´ìš©ìœ¼ë¡œ ë³€ê²½
    implementation "com.querydsl:querydsl-jpa:${queryDslVersion}"
    implementation "com.querydsl:querydsl-apt:${queryDslVersion}"

    //mysql
    runtimeOnly 'com.mysql:mysql-connector-j'

    //s3
    implementation 'io.awspring.cloud:spring-cloud-starter-aws:2.4.2'

    //jwt
    compileOnly group: 'io.jsonwebtoken', name: 'jjwt-api', version: '0.11.2'
    runtimeOnly group: 'io.jsonwebtoken', name: 'jjwt-impl', version: '0.11.2'
    runtimeOnly group: 'io.jsonwebtoken', name: 'jjwt-jackson', version: '0.11.2'

    annotationProcessor 'org.projectlombok:lombok'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'

    // validation
    implementation 'org.springframework.boot:spring-boot-starter-validation'

    // redis
    implementation 'org.springframework.boot:spring-boot-starter-data-redis'

    //p6spy
    implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.8.1'

    //swagger
    implementation 'io.springfox:springfox-swagger2:3.0.0'
    implementation 'io.springfox:springfox-swagger-ui:3.0.0'

}

tasks.named('test') {
    useJUnitPlatform()
}

/*
* queryDSL ì„¤ì • ì¶”ê°€ ğŸ‘‰ ì´ë²ˆ ë²„ì „ì—ì„œëŠ” ì´ ë¶€ë¶„ë„ í•„ìš”ì—†ì–´ì„œ ì „ë¶€ ì‚­ì œ
*/
// querydslì—ì„œ ì‚¬ìš©í•  ê²½ë¡œ ì„¤ì •
def querydslDir = "$buildDir/generated/querydsl"
// JPA ì‚¬ìš© ì—¬ë¶€ì™€ ì‚¬ìš©í•  ê²½ë¡œë¥¼ ì„¤ì •
querydsl {
    library = "com.querydsl:querydsl-apt"
    jpa = true
    querydslSourcesDir = querydslDir
}
// build ì‹œ ì‚¬ìš©í•  sourceSet ì¶”ê°€
sourceSets {
    main.java.srcDir querydslDir
}
// querydsl ì»´íŒŒì¼ì‹œ ì‚¬ìš©í•  ì˜µì…˜ ì„¤ì •
compileQuerydsl {
    options.annotationProcessorPath = configurations.querydsl
}
// querydsl ì´ compileClassPath ë¥¼ ìƒì†í•˜ë„ë¡ ì„¤ì •
configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
    querydsl.extendsFrom compileClasspath
}
jar {
    enabled = false
}

tasks.named('test') {
    useJUnitPlatform()
}

```

í˜„ì¬  
Java(17) / Spring(3.0.2) + Querydsl ì‚¬ìš©ì‹œì˜ build.gradle
```java
plugins {
   id 'java'
   id 'org.springframework.boot' version '3.0.2'
   id 'io.spring.dependency-management' version '1.1.0'
}

group = 'com.ilcle'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '17'

configurations {
   compileOnly {
      extendsFrom annotationProcessor
   }
}

repositories {
   mavenCentral()
}

dependencies {
   implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
   implementation 'org.springframework.boot:spring-boot-starter-security'
   implementation 'org.springframework.boot:spring-boot-starter-web'
   compileOnly 'org.projectlombok:lombok'
   developmentOnly 'org.springframework.boot:spring-boot-devtools'
   runtimeOnly 'com.h2database:h2'
   annotationProcessor 'org.projectlombok:lombok'
   testImplementation 'org.springframework.boot:spring-boot-starter-test'
   testImplementation 'org.springframework.security:spring-security-test'

// querydsl ğŸ‘‰ ë³€ê²½ëœ ë‚´ ì¶”ê°€
   implementation 'com.querydsl:querydsl-core'
   implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
   annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jakarta"
   annotationProcessor "jakarta.annotation:jakarta.annotation-api"
   annotationProcessor "jakarta.persistence:jakarta.persistence-api"

//mysql
implementation 'mysql:mysql-connector-java'

//jwt
compileOnly group: 'io.jsonwebtoken', name: 'jjwt-api', version: '0.11.2'
   runtimeOnly group: 'io.jsonwebtoken', name: 'jjwt-impl', version: '0.11.2'
   runtimeOnly group: 'io.jsonwebtoken', name: 'jjwt-jackson', version: '0.11.2'

//ìŠ¤ì›¨ê±°
implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.0.2'
   implementation 'org.springdoc:springdoc-openapi-starter-common'
}

tasks.named('test') {
   useJUnitPlatform()
}
```

<br/>
<br/>
<br/>
